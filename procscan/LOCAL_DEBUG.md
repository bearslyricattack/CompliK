# ğŸ›¡ï¸ ProcScan æœ¬åœ°è°ƒè¯•æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨æœ¬åœ° Kubernetes ç¯å¢ƒä¸­è°ƒè¯• ProcScan å®‰å…¨æ‰«æå™¨ã€‚

## ğŸ”§ ç¯å¢ƒè¦æ±‚

### å¿…éœ€ç»„ä»¶
- **kubectl**: Kubernetes å‘½ä»¤è¡Œå·¥å…·
- **Go**: ç‰ˆæœ¬ 1.24+
- **æœ¬åœ° Kubernetes é›†ç¾¤** (ä»»é€‰å…¶ä¸€):
  - Docker Desktop (æ¨è)
  - Minikube
  - k3s
  - Kind

### æƒé™è¦æ±‚
- åˆ›å»ºå‘½åç©ºé—´çš„æƒé™
- è·å–å’Œæ›´æ–°å‘½åç©ºé—´çš„æƒé™
- æŸ¥çœ‹ Pod çš„æƒé™

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒæ£€æŸ¥
```bash
# è¿è¡Œç¯å¢ƒæ£€æŸ¥è„šæœ¬
./scripts/local-debug.sh
```

### 2. å¯åŠ¨ ProcScan
```bash
# æ–¹æ³•1: ç›´æ¥è¿è¡Œ Go ç¨‹åº
go run cmd/procscan/main.go -config config.debug.yaml

# æ–¹æ³•2: ä½¿ç”¨æ„å»ºå¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶
./scripts/quick-test.sh
```

### 3. ç›‘æ§æ ‡ç­¾å˜åŒ–
```bash
# åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­å®æ—¶ç›‘æ§
watch kubectl get namespace procscan-debug --show-labels
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ config.debug.yaml          # æœ¬åœ°è°ƒè¯•é…ç½®
â”œâ”€â”€ cmd/procscan/main.go       # ç¨‹åºå…¥å£
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ local-debug.sh         # ç¯å¢ƒæ£€æŸ¥è„šæœ¬
â”‚   â””â”€â”€ quick-test.sh          # å¿«é€Ÿå¯åŠ¨è„šæœ¬
â”œâ”€â”€ examples/
â”‚   â””â”€â”€ test-pod.yaml          # æµ‹è¯• Pod é…ç½®
â””â”€â”€ bin/procscan               # æ„å»ºçš„äºŒè¿›åˆ¶æ–‡ä»¶
```

## ğŸ§ª æµ‹è¯•åœºæ™¯

### æµ‹è¯•å‘½åç©ºé—´
- **åç§°**: `procscan-debug`
- **ç”¨é€”**: ä¸“é—¨ç”¨äºæœ¬åœ°è°ƒè¯•çš„å‘½åç©ºé—´

### æµ‹è¯• Pod
é¡¹ç›®åŒ…å«ä¸¤ä¸ªæµ‹è¯• Pod:

1. **test-malicious-pod**: æ¨¡æ‹Ÿæ¶æ„è¿›ç¨‹
   - è¿è¡ŒåŒ…å« "test-malware" å’Œ "fake-miner" çš„å‘½ä»¤
   - ä¼šè§¦å‘å…³é”®è¯æ£€æµ‹

2. **test-normal-pod**: æ¨¡æ‹Ÿæ­£å¸¸è¿›ç¨‹
   - è¿è¡Œ Nginx æœåŠ¡
   - åº”è¯¥åœ¨ç™½åå•ä¸­

### æ£€æµ‹è§„åˆ™é…ç½®
```yaml
detectionRules:
  blacklist:
    processes: ["^test-malware$", "^fake-miner$"]
    keywords:  ["test-threat", "fake-attack"]

  whitelist:
    processes: ["^nginx$", "^go$", "^kubectl$"]
    commands:  ["go build", "kubectl apply"]
```

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æ—¥å¿—çº§åˆ«
é…ç½®æ–‡ä»¶ä½¿ç”¨ `debug` çº§åˆ«ï¼Œå¯ä»¥çœ‹åˆ°è¯¦ç»†çš„æ‰§è¡Œä¿¡æ¯ï¼š
```yaml
scanner:
  log_level: "debug"
```

### 2. æ‰«æé—´éš”
æœ¬åœ°è°ƒè¯•ä½¿ç”¨è¾ƒçŸ­é—´éš”ï¼š
```yaml
scanner:
  scan_interval: "10s"
```

### 3. å®æ—¶ç›‘æ§
```bash
# ç›‘æ§å‘½åç©ºé—´æ ‡ç­¾
watch kubectl get namespace procscan-debug --show-labels

# ç›‘æ§ Pod çŠ¶æ€
watch kubectl get pods -n procscan-debug

# æŸ¥çœ‹ Pod æ—¥å¿—
kubectl logs test-malicious-pod -n procscan-debug -f
```

## ğŸ¯ æµ‹è¯•æµç¨‹

### åŸºæœ¬æµç¨‹
1. **å¯åŠ¨ ProcScan**: `./scripts/quick-test.sh`
2. **åˆ›å»ºæµ‹è¯•èµ„æº**: `kubectl apply -f examples/test-pod.yaml`
3. **ç›‘æ§æ ‡ç­¾å˜åŒ–**: `watch kubectl get namespace procscan-debug --show-labels`
4. **è§‚å¯Ÿæ—¥å¿—è¾“å‡º**: æŸ¥çœ‹ç¨‹åºè¿è¡Œæ—¥å¿—

### é¢„æœŸç»“æœ
å½“ ProcScan æ£€æµ‹åˆ°å¨èƒæ—¶ï¼Œä¼šï¼š
1. åœ¨æ—¥å¿—ä¸­è¾“å‡ºæ£€æµ‹ä¿¡æ¯
2. åœ¨ `procscan-debug` å‘½åç©ºé—´æ·»åŠ å®‰å…¨æ ‡ç­¾ï¼š
   ```yaml
   clawcloud.run/status: "locked"
   scan.detected: "true"
   scan.tool: "procscan"
   security.threat.level: "high"
   response.status: "pending"
   ```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. K8s è¿æ¥å¤±è´¥
**é”™è¯¯**: `æ— æ³•åˆ›å»ºK8så®¢æˆ·ç«¯`
**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿ Kubernetes é›†ç¾¤æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥ `~/.kube/config` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- è¿è¡Œ `kubectl cluster-info` éªŒè¯è¿æ¥

#### 2. æƒé™ä¸è¶³
**é”™è¯¯**: `æ²¡æœ‰æ›´æ–°å‘½åç©ºé—´çš„æƒé™`
**è§£å†³æ–¹æ¡ˆ**:
- å¯¹äº Docker Desktop: ç¡®ä¿å·²å¯ç”¨ Kubernetes
- å¯¹äº Minikube/k3s: å¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™
- ä½¿ç”¨ `kubectl auth can-i update namespaces` æ£€æŸ¥æƒé™

#### 3. æ£€æµ‹ä¸åˆ°å¨èƒ
**å¯èƒ½åŸå› **:
- æµ‹è¯• Pod æœªæ­£å¸¸è¿è¡Œ
- æ£€æµ‹è§„åˆ™é…ç½®ä¸å½“
- å®¹å™¨ä¿¡æ¯è·å–å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ Pod çŠ¶æ€: `kubectl get pods -n procscan-debug`
- æŸ¥çœ‹ç¨‹åºæ—¥å¿—ï¼Œç¡®è®¤è¿›ç¨‹æ‰«ææ˜¯å¦æ­£å¸¸
- è°ƒæ•´æ£€æµ‹è§„åˆ™é…ç½®

#### 4. æ ‡ç­¾æœªæ·»åŠ 
**å¯èƒ½åŸå› **:
- K8s å®¢æˆ·ç«¯æœªæ­£ç¡®åˆå§‹åŒ–
- æƒé™ä¸è¶³
- æ£€æµ‹é€»è¾‘é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥å¯åŠ¨æ—¥å¿—ä¸­çš„ K8s å®¢æˆ·ç«¯çŠ¶æ€
- éªŒè¯æƒé™è®¾ç½®
- æŸ¥çœ‹è¯¦ç»†çš„ debug æ—¥å¿—

## ğŸ“ å¼€å‘å»ºè®®

### 1. ä¿®æ”¹æ£€æµ‹è§„åˆ™
ç¼–è¾‘ `config.debug.yaml` ä¸­çš„æ£€æµ‹è§„åˆ™æ¥æµ‹è¯•ä¸åŒåœºæ™¯ã€‚

### 2. æ·»åŠ æ–°çš„æµ‹è¯• Pod
åœ¨ `examples/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æµ‹è¯•èµ„æºé…ç½®ã€‚

### 3. æ‰©å±•åŠŸèƒ½
- æ·»åŠ æ–°çš„é€šçŸ¥å™¨
- å®ç°æ›´å¤æ‚çš„æ£€æµ‹é€»è¾‘
- é›†æˆå…¶ä»–å®‰å…¨å·¥å…·

## ğŸ§¹ æ¸…ç†

è°ƒè¯•å®Œæˆåï¼Œæ¸…ç†æµ‹è¯•èµ„æºï¼š
```bash
# åˆ é™¤æµ‹è¯•å‘½åç©ºé—´
kubectl delete namespace procscan-debug

# åˆ é™¤äºŒè¿›åˆ¶æ–‡ä»¶
rm -f bin/procscan
```

## ğŸ“ è·å–å¸®åŠ©

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹ç¨‹åºæ—¥å¿—è¾“å‡º
2. æ£€æŸ¥ Kubernetes é›†ç¾¤çŠ¶æ€
3. éªŒè¯æƒé™é…ç½®
4. å‚è€ƒæœ¬æŒ‡å—çš„æ•…éšœæ’é™¤éƒ¨åˆ†

---

**ğŸ‰ æœ¬åœ°è°ƒè¯•ç¯å¢ƒå·²å‡†å¤‡å°±ç»ªï¼å¼€å§‹æ‚¨çš„å®‰å…¨æ‰«ææµ‹è¯•ä¹‹æ—…å§ï¼**