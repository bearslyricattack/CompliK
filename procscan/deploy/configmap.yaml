# ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: block-procscan-config
  namespace: block-system
data:
  config.yaml: |
    # =============================================================================
    # ğŸ›¡ï¸ ProcScan å®‰å…¨æ‰«æå™¨é…ç½®æ–‡ä»¶
    # =============================================================================

    # =============================================================================
    # ğŸ” æ‰«æå™¨æ ¸å¿ƒé…ç½® (Scanner)
    # =============================================================================
    scanner:
      # è¿›ç¨‹æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ (å®¹å™¨ä¸­éœ€è¦æŒ‚è½½å®¿ä¸»æœºçš„ /proc)
      proc_path: "/host/proc"

      # æ‰«æé—´éš”æ—¶é—´
      scan_interval: "30s"

      # æ—¥å¿—çº§åˆ«
      log_level: "info"

    # =============================================================================
    # âš¡ è‡ªåŠ¨åŒ–å“åº”é…ç½® (Actions)
    # =============================================================================
    actions:
      # å‘½åç©ºé—´æ ‡ç­¾åŠŸèƒ½
      label:
        enabled: true
        data:
          # å®‰å…¨çŠ¶æ€æ ‡ç­¾ (ä¸»è¦æ ‡è¯†)
          clawcloud.run/status: "locked"

    # =============================================================================
    # ğŸ“¢ é€šçŸ¥æ¸ é“é…ç½® (Notifications)
    # =============================================================================
    notifications:
      # é£ä¹¦é€šçŸ¥é…ç½®
      lark:
        webhook: "https://open.feishu.cn/open-apis/bot/v2/hook/de0df867-9457-49be-a747-e01274a319cc"
        timeout: "30s"
        retry_count: 3

    # =============================================================================
    # ğŸ“Š Prometheus æŒ‡æ ‡é…ç½® (Metrics)
    # =============================================================================
    metrics:
      # å¯ç”¨æŒ‡æ ‡æœåŠ¡å™¨
      enabled: true

      # æŒ‡æ ‡æœåŠ¡å™¨ç«¯å£
      port: 8080

      # æŒ‡æ ‡æš´éœ²è·¯å¾„
      path: "/metrics"

      # HTTP è¯»å–è¶…æ—¶
      read_timeout: "10s"

      # HTTP å†™å…¥è¶…æ—¶
      write_timeout: "10s"

      # å¯åŠ¨å¤±è´¥æœ€å¤§é‡è¯•æ¬¡æ•°
      max_retries: 3

      # é‡è¯•é—´éš”
      retry_interval: "5s"

    # =============================================================================
    # ğŸ” æ£€æµ‹è§„åˆ™é…ç½® (Detection Rules)
    # =============================================================================
    detectionRules:
      # é»‘åå•è§„åˆ™
      blacklist:
        processes:
          - "miner"
          - "xmrig"
          - "crypto-miner"
          - "kinsing"
          - "kdevtmpfsi"
          - "ccminer"
          - "cpuminer"
        keywords:
          - "stratum+tcp"
          - "pool."
          - "monero"
          - "cryptonight"
          - "wallet"
        commands: []
        namespaces: []
        podNames: []

      # ç™½åå•è§„åˆ™
      whitelist:
        processes:
          - "sh"
          - "bash"
          - "python"
          - "java"
          - "node"
          - "npm"
          - "go"
          - "kubelet"
          - "kube-proxy"
          - "containerd"
          - "dockerd"
        commands:
          - "kubectl"
          - "git"
          - "make"
          - "go build"
        namespaces:
          - "kube-system"
          - "kube-public"
          - "kube-node-lease"
          - "block-system"
        podNames:
          - "coredns-.*"
          - "etcd-.*"
          - "kube-apiserver-.*"
          - "kube-controller-manager-.*"
          - "kube-scheduler-.*"
