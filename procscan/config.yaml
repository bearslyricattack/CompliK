# =============================================================================
# ğŸ›¡ï¸ ProcScan å®‰å…¨æ‰«æå™¨é…ç½®æ–‡ä»¶
# =============================================================================
# ç”¨äºæ£€æµ‹å®¹å™¨å†…çš„å¯ç–‘è¿›ç¨‹æ´»åŠ¨å¹¶è‡ªåŠ¨å“åº”

# =============================================================================
# ğŸ” æ‰«æå™¨æ ¸å¿ƒé…ç½® (Scanner)
# =============================================================================
scanner:
  # è¿›ç¨‹æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ (å®¹å™¨ä¸­éœ€è¦æŒ‚è½½å®¿ä¸»æœºçš„ /proc)
  # å®¹å™¨åŒ–éƒ¨ç½²æ—¶éœ€è¦é€šè¿‡ volumeMounts æŒ‚è½½å®¿ä¸»æœºçš„ /proc ç›®å½•
  proc_path: "/host/proc"
  # æ‰«æé—´éš”æ—¶é—´ (æ¨è: 30s-300s)
  # è¿‡çŸ­ä¼šå¢åŠ ç³»ç»Ÿè´Ÿè½½ï¼Œè¿‡é•¿å¯èƒ½å»¶è¿Ÿå¨èƒæ£€æµ‹
  scan_interval: "100s"
  # æ—¥å¿—çº§åˆ« (debug, info, warn, error)
  # debug: è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œé€‚åˆå¼€å‘ç¯å¢ƒ
  # info:  ä¸€èˆ¬ä¿¡æ¯ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ
  # warn:  è­¦å‘Šä¿¡æ¯
  # error: ä»…é”™è¯¯ä¿¡æ¯
  log_level: "info"
# =============================================================================
# âš¡ è‡ªåŠ¨åŒ–å“åº”é…ç½® (Actions)
# =============================================================================
actions:
  # å‘½åç©ºé—´æ ‡ç­¾åŠŸèƒ½ (æ¨èå¯ç”¨)
  # å½“æ£€æµ‹åˆ°å¨èƒæ—¶ï¼Œä¸ºå‘½åç©ºé—´æ·»åŠ æ ‡ç­¾ï¼Œä¾›å¤–éƒ¨æ§åˆ¶å™¨å¤„ç†
  label:
    # æ˜¯å¦å¯ç”¨æ ‡ç­¾åŠŸèƒ½
    enabled: true
    # æ ‡ç­¾æ•°æ® (å°†è¢«æ·»åŠ åˆ°å—å½±å“çš„å‘½åç©ºé—´)
    data:
      # å®‰å…¨çŠ¶æ€æ ‡ç­¾ (ä¸»è¦æ ‡è¯†)
      clawcloud.run/status: "locked"

# =============================================================================
# ğŸ“¢ é€šçŸ¥æ¸ é“é…ç½® (Notifications)
# =============================================================================
notifications:
  # é£ä¹¦é€šçŸ¥é…ç½®
  lark:
    # é£ä¹¦æœºå™¨äºº Webhook URL (è·å–æ–¹å¼: é£ä¹¦ç¾¤ -> è®¾ç½® -> æœºå™¨äºº -> è‡ªå®šä¹‰æœºå™¨äºº)
    # ç•™ç©ºåˆ™ä¸å‘é€é£ä¹¦é€šçŸ¥
    webhook: "https://open.feishu.cn/open-apis/bot/v2/hook/de0df867-9457-49be-a747-e01274a319cc"
    # HTTP è¯·æ±‚è¶…æ—¶æ—¶é—´ (æ¨è: 10s-30s)
    timeout: "30s"
    # å‘é€å¤±è´¥é‡è¯•æ¬¡æ•° (æ¨è: 1-3æ¬¡)
    retry_count: 3

# =============================================================================
# ğŸ” æ£€æµ‹è§„åˆ™é…ç½® (Detection Rules)
# =============================================================================
detectionRules:
  # é»‘åå•è§„åˆ™ (Blacklist)
  # åŒ¹é…åˆ°é»‘åå•è§„åˆ™çš„è¿›ç¨‹å°†è¢«æ ‡è®°ä¸ºå¨èƒ
  blacklist:
    # é»‘åå•è¿›ç¨‹å (æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼)
    # è¿›ç¨‹åå®Œå…¨åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„è¿›ç¨‹å°†è¢«æ ‡è®°
    processes:
      # æŒ–çŸ¿è½¯ä»¶
      - "^miner$"                    # miner çŸ¿å·¥ç¨‹åº
      - "^xmrig$"                    # XMRig é—¨ç½—å¸æŒ–çŸ¿ç¨‹åº
      - "^xmrig-vrl$"                # XMRig å˜ä½“
      - "^argosb$"                   # Argos æŒ–çŸ¿ç¨‹åº
      - "^asd$"                      # æœªçŸ¥æŒ–çŸ¿ç¨‹åº
      - "^kdevtmpfsi$"               # Kinsing æŒ–çŸ¿ç¨‹åº
      - "^kinsing$"                  # Kinsing æŒ–çŸ¿ç¨‹åº
      - "^crypto-miner$"             # é€šç”¨åŠ å¯†è´§å¸æŒ–çŸ¿ç¨‹åº
      - "^ccminer$"                  # ccminer æŒ–çŸ¿ç¨‹åº
      - "^cpuminer$"                 # cpuminer æŒ–çŸ¿ç¨‹åº
      - "^bfgminer$"                  # bfgminer æŒ–çŸ¿ç¨‹åº
      - "^nsgminer$"                  # nsgminer æŒ–çŸ¿ç¨‹åº
      - "^teamredminer$"             # Team Red Miner æŒ–çŸ¿ç¨‹åº
      - "^nbminer$"                  # NBMiner æŒ–çŸ¿ç¨‹åº
      - "^t-rex$"                    # T-Rex æŒ–çŸ¿ç¨‹åº
      # åå‘Shellå’Œåé—¨ç¨‹åº
      - "^bash.*reverse.*shell"      # bash åå‘shell
      - "^nc.*-l.*-p"                # netcat ç›‘å¬æ¨¡å¼
      - "^socat.*TCP-LISTEN"          # socat ç«¯å£è½¬å‘
      - "^python.*socket.*"          # Python socket ç¼–ç¨‹
      - "^perl.*socket.*"            # Perl socket ç¼–ç¨‹
      # å…¶ä»–æ¶æ„ç¨‹åº
      - "^masscan$"                  # ç«¯å£æ‰«æå·¥å…·
      - "^nmap$"                     # ç½‘ç»œæ‰«æå·¥å…·
      - "^sqlmap$"                   # SQLæ³¨å…¥å·¥å…·
      - "^nikto$"                    # Webæ¼æ´æ‰«æå·¥å…·
      - "^hydra$"                    # æš´åŠ›ç ´è§£å·¥å…·

    # é»‘åå•å‘½ä»¤å…³é”®è¯ (æ”¯æŒå­—ç¬¦ä¸²åŒ¹é…ï¼Œéæ­£åˆ™)
    # è¿›ç¨‹å‘½ä»¤è¡ŒåŒ…å«ä»¥ä¸‹å…³é”®è¯çš„å°†è¢«æ ‡è®°
    keywords:
      # æŒ–çŸ¿ç›¸å…³å…³é”®è¯
      - "stratum+tcp"                # æŒ–çŸ¿åè®®
      - "pool."                      # æŒ–çŸ¿æ± åœ°å€
      - "monero"                     # é—¨ç½—å¸
      - "cryptonight"                # CryptoNightç®—æ³•
      - "ethash"                     # Ethashç®—æ³•
      - "scrypt"                     # Scryptç®—æ³•
      - "wallet"                     # é’±åŒ…åœ°å€
      - "donate-level"               # æèµ çº§åˆ«
      # ç½‘ç»œæ”»å‡»å…³é”®è¯
      - "reverse shell"              # åå‘shell
      - "bind shell"                 # ç»‘å®šshell
      - "port scan"                  # ç«¯å£æ‰«æ
      - "ddos"                       # DDoSæ”»å‡»
      - "botnet"                     # åƒµå°¸ç½‘ç»œ
      # å…¶ä»–å¯ç–‘å…³é”®è¯
      - "password"                   # å¯†ç ç›¸å…³
      - "shadow"                     # ç³»ç»Ÿå¯†ç æ–‡ä»¶
      - "/etc/passwd"                # ç³»ç»Ÿç”¨æˆ·æ–‡ä»¶
      - "/etc/shadow"                # ç³»ç»Ÿå¯†ç æ–‡ä»¶
      - "rootkit"                    # Rootkit
      - "backdoor"                   # åé—¨ç¨‹åº

  # ç™½åå•è§„åˆ™ (Whitelist)
  # åŒ¹é…åˆ°ç™½åå•è§„åˆ™çš„è¿›ç¨‹å°†è¢«å¿½ç•¥ï¼Œå³ä½¿åŒ¹é…é»‘åå•
  whitelist:
    # ç™½åå•è¿›ç¨‹å (æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼)
    # ç³»ç»Ÿå…³é”®è¿›ç¨‹ï¼Œè¯¯æŠ¥ç‡è¾ƒé«˜ï¼Œå»ºè®®åŠ å…¥ç™½åå•
    processes:
      # Kubernetes ç³»ç»Ÿç»„ä»¶
      - "^kubelet$"                  # Kubelet èŠ‚ç‚¹ä»£ç†
      - "^kube-proxy$"               # Kube-proxy ç½‘ç»œä»£ç†
      - "^containerd$"               # containerd å®¹å™¨è¿è¡Œæ—¶
      - "^containerd-shim$"          # containerd shim
      - "^dockerd$"                  # Docker å®ˆæŠ¤è¿›ç¨‹
      - "^docker-proxy$"            # Docker ç½‘ç»œä»£ç†
      - "^runc$"                     # runc å®¹å™¨è¿è¡Œæ—¶
      - "^crictl$"                   # containerd CLI
      - "^nerdctl$"                  # containerd CLI

      # ç³»ç»Ÿå…³é”®è¿›ç¨‹
      - "^init$"                     # ç³»ç»Ÿåˆå§‹åŒ–è¿›ç¨‹ (PID 1)
      - "^systemd$"                  # systemd ç³»ç»Ÿç®¡ç†å™¨
      - "^bash$"                     # Bash shell
      - "^sh$"                       # Shell
      - "^zsh$"                      # Zsh shell
      - "^dash$"                     # Debian Almquist Shell
      - "^ksh$"                      # KornShell
      - "^tcsh$"                     # TENEX C Shell
      - "^csh$"                      # C Shell
      - "^fish$"                     # Fish shell
      - "^busybox$"                  # BusyBox
      - "^coreutils$"                # GNUæ ¸å¿ƒå·¥å…·é›†
      - "^util-linux$"               # Linuxå®ç”¨å·¥å…·
      - "^procps$"                   # è¿›ç¨‹å·¥å…·é›† (ps, topç­‰)

      # ç›‘æ§å’Œæ—¥å¿—ç›¸å…³
      - "^prometheus-node-exporter$" # PrometheusèŠ‚ç‚¹å¯¼å‡ºå™¨
      - "^fluentd$"                  # Fluentd æ—¥å¿—æ”¶é›†å™¨
      - "^filebeat$"                 # Filebeat æ—¥å¿—æ”¶é›†å™¨
      - "^metricbeat$"               # Metricbeat æŒ‡æ ‡æ”¶é›†å™¨
      - "^jaeger-agent$"             # Jaegeré“¾è·¯è¿½è¸ªä»£ç†
      - "^istio-proxy$"              # Istioè¾¹è½¦ä»£ç†
      - "^envoy$"                    # Envoyä»£ç†
      - "^linkerd-proxy$"            # Linkerdä»£ç†

      # åº”ç”¨ç¨‹åºæ¡†æ¶
      - "^java$"                     # Javaåº”ç”¨ç¨‹åº
      - "^node$"                     # Node.jsåº”ç”¨ç¨‹åº
      - "^npm$"                      # Node Package Manager
      - "^yarn$"                     # Yarn Package Manager
      - "^python$"                   # Pythonåº”ç”¨ç¨‹åº
      - "^pip$"                      # Python Package Installer
      - "^go$"                       # Goåº”ç”¨ç¨‹åº
      - "^java$"                     # Javaè™šæ‹Ÿæœº
      - "^nginx$"                    # Nginx WebæœåŠ¡å™¨
      - "^apache$"                   # Apache WebæœåŠ¡å™¨
      - "^httpd$"                    # HTTPå®ˆæŠ¤è¿›ç¨‹
      - "^redis-server$"             # RedisæœåŠ¡å™¨
      - "^mysqld$"                   # MySQLæœåŠ¡å™¨
      - "^postgres$"                 # PostgreSQLæœåŠ¡å™¨
      - "^mongodb$"                  # MongoDBæœåŠ¡å™¨

    # ç™½åå•å‘½ä»¤å…³é”®è¯ (æ”¯æŒå­—ç¬¦ä¸²åŒ¹é…)
    # è¿›ç¨‹å‘½ä»¤è¡ŒåŒ…å«ä»¥ä¸‹å…³é”®è¯çš„å°†è¢«å¿½ç•¥
    commands:
      # ç³»ç»Ÿç»´æŠ¤å‘½ä»¤
      - "apt-get"                    # APTåŒ…ç®¡ç†å™¨
      - "yum"                        # YUMåŒ…ç®¡ç†å™¨
      - "dnf"                        # DNFåŒ…ç®¡ç†å™¨
      - "pacman"                     # PacmanåŒ…ç®¡ç†å™¨
      - "systemctl"                  # systemd æ§åˆ¶å‘½ä»¤
      - "service"                    # æœåŠ¡æ§åˆ¶å‘½ä»¤
      - "journalctl"                 # systemd æ—¥å¿—å‘½ä»¤

      # å¼€å‘å·¥å…·å‘½ä»¤
      - "git"                        # Gitç‰ˆæœ¬æ§åˆ¶
      - "make"                       # Makeæ„å»ºå·¥å…·
      - "cmake"                      # CMakeæ„å»ºå·¥å…·
      - "gcc"                        # GCCç¼–è¯‘å™¨
      - "g++"                        # G++ç¼–è¯‘å™¨
      - "mvn"                        # Mavenæ„å»ºå·¥å…·
      - "gradle"                     # Gradleæ„å»ºå·¥å…·
      - "npm"                        # Node.jsåŒ…ç®¡ç†å™¨
      - "pip"                        # PythonåŒ…ç®¡ç†å™¨
      - "docker"                     # Dockerå‘½ä»¤

      # ç›‘æ§å’Œæ—¥å¿—å‘½ä»¤
      - "kubectl"                    # Kubernetes CLI
      - "helm"                       # HelmåŒ…ç®¡ç†å™¨
      - "kustomize"                  # Kustomizeé…ç½®ç®¡ç†
      - "istioctl"                   # Istio CLI
      - "linkerd"                    # Linkerd CLI

    # ç™½åå•å‘½åç©ºé—´ (æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼)
    # åœ¨è¿™äº›å‘½åç©ºé—´ä¸­çš„è¿›ç¨‹å°†è¢«å¿½ç•¥
    namespaces:
      # Kubernetes ç³»ç»Ÿå‘½åç©ºé—´
      - "^kube-system$"              # Kubernetesç³»ç»Ÿç»„ä»¶
      - "^kube-public$"              # Kuberneteså…¬å…±èµ„æº
      - "^kube-node-lease$"          # KubernetesèŠ‚ç‚¹ç§Ÿçº¦
      - "^istio-system$"             # IstioæœåŠ¡ç½‘æ ¼
      - "^linkerd$"                  # LinkerdæœåŠ¡ç½‘æ ¼
      - "^gatekeeper-system$"        # Gatekeeperç­–ç•¥æ‰§è¡Œå™¨
      - "^cert-manager$"             # cert-managerè¯ä¹¦ç®¡ç†
      - "^nginx-ingress$"             # NGINX Ingressæ§åˆ¶å™¨
      - "^traefik$"                  # Traefik Ingressæ§åˆ¶å™¨
      - "^prometheus-operator$"      # Prometheusæ“ä½œå™¨
      - "^monitoring$"               # ç›‘æ§ç³»ç»Ÿ
      - "^logging$"                  # æ—¥å¿—ç³»ç»Ÿ
      - "^kubevirt$"                 # Kubevirtè™šæ‹ŸåŒ–
      - "^rook-ceph$"                # Rook Cephå­˜å‚¨

      # åº”ç”¨ç³»ç»Ÿå‘½åç©ºé—´
      - "^default$"                  # é»˜è®¤å‘½åç©ºé—´
      - "^ingress-nginx$"            # NGINX Ingress
      - "^kube-dns$"                 # CoreDNS

    # ç™½åå•Podåç§° (æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼)
    # è¿™äº›Podçš„è¿›ç¨‹å°†è¢«å¿½ç•¥
    podNames:
      # ç³»ç»ŸPod
      - "^coredns-.*"                # CoreDNS Pod
      - "^etcd-.*"                   # etcd Pod
      - "^kube-apiserver-.*"         # Kubernetes API Server
      - "^kube-controller-manager-.*" # æ§åˆ¶å™¨ç®¡ç†å™¨
      - "^kube-scheduler-.*"         # è°ƒåº¦å™¨
      - "^kube-proxy-.*"             # ç½‘ç»œä»£ç†
      - "^fluentd-.*"                # Fluentdæ—¥å¿—æ”¶é›†å™¨
      - "^node-exporter-.*"          # èŠ‚ç‚¹å¯¼å‡ºå™¨
      - "^prometheus-.*"             # Prometheusç›‘æ§
      - "^grafana-.*"                # Grafanaå¯è§†åŒ–
      - "^alertmanager-.*"           # å‘Šè­¦ç®¡ç†å™¨

      # ç½‘ç»œç›¸å…³Pod
      - "^nginx-ingress-controller-.*" # NGINX Ingressæ§åˆ¶å™¨
      - "^traefik-.*"                # Traefikåå‘ä»£ç†
      - "^envoy-.*"                  # Envoyä»£ç†
      - "^istio-proxy-.*"           # Istioè¾¹è½¦ä»£ç†

      # åº”ç”¨Pod
      - "^jenkins-.*"                # Jenkins CI/CD
      - "^gitlab-runner-.*"          # GitLab Runner
      - "^elasticsearch-.*"          # Elasticsearchæœç´¢å¼•æ“
      - "^kibana-.*"                 # Kibanaå¯è§†åŒ–
      - "^logstash-.*"               # Logstashæ—¥å¿—å¤„ç†
      - "^redis-.*"                  # Redisç¼“å­˜
      - "^postgresql-.*"             # PostgreSQLæ•°æ®åº“
      - "^mysql-.*"                  # MySQLæ•°æ®åº“
      - "^mongodb-.*"                # MongoDBæ•°æ®åº“

# =============================================================================
# ğŸ“ é…ç½®æ–‡ä»¶è¯´æ˜
# =============================================================================
#
# ä½¿ç”¨æ–¹æ³•:
# 1. å°†æ­¤é…ç½®æ–‡ä»¶æŒ‚è½½åˆ° Pod ä¸­çš„ /app/config.yaml
# 2. æˆ–é€šè¿‡ç¯å¢ƒå˜é‡ APROCSCAN_CONFIG_PATH æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„
# 3. æˆ–é€šè¿‡ç¯å¢ƒå˜é‡é€ä¸ªè¦†ç›–é…ç½®é¡¹
#
# ç¯å¢ƒå˜é‡è¦†ç›–è§„åˆ™:
# - PROCSCAN_SCANNER_PROC_PATH: è¦†ç›– scanner.proc_path
# - PROCSCAN_SCANNER_SCAN_INTERVAL: è¦†ç›– scanner.scan_interval
# - PROCSCAN_SCANNER_LOG_LEVEL: è¦†ç›– scanner.log_level
# - PROCSCAN_ACTIONS_LABEL_ENABLED: è¦†ç›– actions.label.enabled
# - PROCSCAN_NOTIFICATIONS_LARK_WEBHOOK: è¦†ç›– notifications.lark.webhook
#
# éƒ¨ç½²å»ºè®®:
# 1. ç”Ÿäº§ç¯å¢ƒå»ºè®®æ‰«æé—´éš” 60s-300s
# 2. å¼€å‘æµ‹è¯•ç¯å¢ƒå¯ä»¥è®¾ç½®è¾ƒçŸ­é—´éš” 30s
# 3. æ—¥å¿—çº§åˆ«ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ info æˆ– warn
# 4. ç™½åå•è§„åˆ™éœ€è¦æ ¹æ®å®é™…ç¯å¢ƒè°ƒæ•´
# 5. å®šæœŸæ›´æ–°é»‘åå•è§„åˆ™ä»¥åº”å¯¹æ–°å‹å¨èƒ
# =============================================================================