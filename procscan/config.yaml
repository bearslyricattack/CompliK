# =============================================================================
# ProcScan Security Scanner Configuration File
# =============================================================================
# Used to detect suspicious process activities in containers and respond automatically

# =============================================================================
# Scanner Core Configuration (Scanner)
# =============================================================================
scanner:
  # Process filesystem path (container needs to mount host's /proc)
  # When containerized, mount host's /proc directory via volumeMounts
  proc_path: "/host/proc"
  # Scan interval (recommended: 30s-300s)
  # Too short increases system load, too long may delay threat detection
  scan_interval: "100s"
  # Log level (debug, info, warn, error)
  # debug: detailed debug info, suitable for development
  # info:  general info, suitable for production
  # warn:  warning messages
  # error: error messages only
  log_level: "debug"
# =============================================================================
# Automated Response Configuration (Actions)
# =============================================================================
actions:
  # Namespace labeling feature (recommended to enable)
  # When a threat is detected, add labels to the namespace for external controller processing
  label:
    # Whether to enable labeling
    enabled: false
    # Label data (will be added to affected namespaces)
    data:
      # Security status label (main identifier)
      clawcloud.run/status: "locked"

# =============================================================================
# Notification Channel Configuration (Notifications)
# =============================================================================
notifications:
  # Lark (Feishu) notification configuration
  lark:
    # Lark bot webhook URL (How to get: Lark group -> Settings -> Bot -> Custom bot)
    # Leave empty to disable Lark notifications
    webhook: "https://open.feishu.cn/open-apis/bot/v2/hook/de0df867-9457-49be-a747-e01274a319cc"
    # HTTP request timeout (recommended: 10s-30s)
    timeout: "30s"
    # Retry count on send failure (recommended: 1-3 times)
    retry_count: 3
  # Region configuration
  region: "hzh"

# =============================================================================
# Metrics Configuration (Metrics)
# =============================================================================
metrics:
  enabled: true
  port: 8080
  path: "/metrics"

# =============================================================================
# API Server Configuration (API)
# =============================================================================
# HTTP API 服务器，用于聚合服务查询违规记录
api:
  enabled: true
  port: 9090

# =============================================================================
# Detection Rules Configuration (Detection Rules)
# =============================================================================
detectionRules:
  # Blacklist rules (Blacklist)
  # Processes matching blacklist rules will be marked as threats
  blacklist:
    # Blacklist process names (supports regex)
    # Processes with names fully matching regex will be marked
    processes:
      # Mining software
      - "^miner$"                    # miner mining program
      - "^xmrig$"                    # XMRig Monero mining program
      - "^xmrig-vrl$"                # XMRig variant
      - "^argosb$"                   # Argos mining program
      - "^asd$"                      # unknown mining program
      - "^kdevtmpfsi$"               # Kinsing mining program
      - "^kinsing$"                  # Kinsing mining program
      - "^crypto-miner$"             # generic cryptocurrency mining program
      - "^ccminer$"                  # ccminer mining program
      - "^cpuminer$"                 # cpuminer mining program
      - "^bfgminer$"                  # bfgminer mining program
      - "^nsgminer$"                  # nsgminer mining program
      - "^teamredminer$"             # Team Red Miner mining program
      - "^nbminer$"                  # NBMiner mining program
      - "^t-rex$"                    # T-Rex mining program
      # Reverse shells and backdoor programs
      - "^bash.*reverse.*shell"      # bash reverse shell
      - "^nc.*-l.*-p"                # netcat listening mode
      - "^socat.*TCP-LISTEN"          # socat port forwarding
      - "^python.*socket.*"          # Python socket programming
      - "^perl.*socket.*"            # Perl socket programming
      # Other malicious programs
      - "^masscan$"                  # port scanning tool
      - "^nmap$"                     # network scanning tool
      - "^sqlmap$"                   # SQL injection tool
      - "^nikto$"                    # web vulnerability scanning tool
      - "^hydra$"                    # brute force tool

    # Blacklist command keywords (supports string matching, not regex)
    # Processes with command line containing these keywords will be marked
    keywords:
      # Mining-related keywords
      - "stratum+tcp"                # mining protocol
      - "pool."                      # mining pool address
      - "monero"                     # Monero
      - "cryptonight"                # CryptoNight algorithm
      - "ethash"                     # Ethash algorithm
      - "scrypt"                     # Scrypt algorithm
      - "wallet"                     # wallet address
      - "donate-level"               # donation level
      # Network attack keywords
      - "reverse shell"              # reverse shell
      - "bind shell"                 # bind shell
      - "port scan"                  # port scanning
      - "ddos"                       # DDoS attack
      - "botnet"                     # botnet
      # Other suspicious keywords
      - "password"                   # password related
      - "shadow"                     # system password file
      - "/etc/passwd"                # system user file
      - "/etc/shadow"                # system password file
      - "rootkit"                    # Rootkit
      - "backdoor"                   # backdoor program

  # Whitelist rules (Whitelist)
  # Processes matching whitelist rules will be ignored, even if they match blacklist
  whitelist:
    # Whitelist process names (supports regex)
    # Critical system processes with high false positive rate, recommended to add to whitelist
    processes:
      # Kubernetes system components
      - "^kubelet$"                  # Kubelet node agent
      - "^kube-proxy$"               # Kube-proxy network proxy
      - "^containerd$"               # containerd container runtime
      - "^containerd-shim$"          # containerd shim
      - "^dockerd$"                  # Docker daemon
      - "^docker-proxy$"            # Docker network proxy
      - "^runc$"                     # runc container runtime
      - "^crictl$"                   # containerd CLI
      - "^nerdctl$"                  # containerd CLI

      # Critical system processes
      - "^init$"                     # system initialization process (PID 1)
      - "^systemd$"                  # systemd system manager
      - "^bash$"                     # Bash shell
      - "^sh$"                       # Shell
      - "^zsh$"                      # Zsh shell
      - "^dash$"                     # Debian Almquist Shell
      - "^ksh$"                      # KornShell
      - "^tcsh$"                     # TENEX C Shell
      - "^csh$"                      # C Shell
      - "^fish$"                     # Fish shell
      - "^busybox$"                  # BusyBox
      - "^coreutils$"                # GNU core utilities
      - "^util-linux$"               # Linux utility tools
      - "^procps$"                   # process tools (ps, top, etc.)

      # Monitoring and logging related
      - "^prometheus-node-exporter$" # Prometheus node exporter
      - "^fluentd$"                  # Fluentd log collector
      - "^filebeat$"                 # Filebeat log collector
      - "^metricbeat$"               # Metricbeat metrics collector
      - "^jaeger-agent$"             # Jaeger tracing agent
      - "^istio-proxy$"              # Istio sidecar proxy
      - "^envoy$"                    # Envoy proxy
      - "^linkerd-proxy$"            # Linkerd proxy

      # Application frameworks
      - "^java$"                     # Java application
      - "^node$"                     # Node.js application
      - "^npm$"                      # Node Package Manager
      - "^yarn$"                     # Yarn Package Manager
      - "^python$"                   # Python application
      - "^pip$"                      # Python Package Installer
      - "^go$"                       # Go application
      - "^java$"                     # Java Virtual Machine
      - "^nginx$"                    # Nginx web server
      - "^apache$"                   # Apache web server
      - "^httpd$"                    # HTTP daemon
      - "^redis-server$"             # Redis server
      - "^mysqld$"                   # MySQL server
      - "^postgres$"                 # PostgreSQL server
      - "^mongodb$"                  # MongoDB server

    # Whitelist command keywords (supports string matching)
    # Processes with command line containing these keywords will be ignored
    commands:
      # System maintenance commands
      - "apt-get"                    # APT package manager
      - "yum"                        # YUM package manager
      - "dnf"                        # DNF package manager
      - "pacman"                     # Pacman package manager
      - "systemctl"                  # systemd control command
      - "service"                    # service control command
      - "journalctl"                 # systemd journal command

      # Development tools commands
      - "git"                        # Git version control
      - "make"                       # Make build tool
      - "cmake"                      # CMake build tool
      - "gcc"                        # GCC compiler
      - "g++"                        # G++ compiler
      - "mvn"                        # Maven build tool
      - "gradle"                     # Gradle build tool
      - "npm"                        # Node.js package manager
      - "pip"                        # Python package manager
      - "docker"                     # Docker command

      # Monitoring and logging commands
      - "kubectl"                    # Kubernetes CLI
      - "helm"                       # Helm package manager
      - "kustomize"                  # Kustomize configuration management
      - "istioctl"                   # Istio CLI
      - "linkerd"                    # Linkerd CLI

    # Whitelist namespaces (supports regex)
    # Processes in these namespaces will be ignored
    namespaces:
      # Kubernetes system namespaces
      - "^kube-system$"              # Kubernetes system components
      - "^kube-public$"              # Kubernetes public resources
      - "^kube-node-lease$"          # Kubernetes node lease
      - "^istio-system$"             # Istio service mesh
      - "^linkerd$"                  # Linkerd service mesh
      - "^gatekeeper-system$"        # Gatekeeper policy enforcer
      - "^cert-manager$"             # cert-manager certificate management
      - "^nginx-ingress$"             # NGINX Ingress controller
      - "^traefik$"                  # Traefik Ingress controller
      - "^prometheus-operator$"      # Prometheus operator
      - "^monitoring$"               # monitoring system
      - "^logging$"                  # logging system
      - "^kubevirt$"                 # Kubevirt virtualization
      - "^rook-ceph$"                # Rook Ceph storage

      # Application system namespaces
      - "^default$"                  # default namespace
      - "^ingress-nginx$"            # NGINX Ingress
      - "^kube-dns$"                 # CoreDNS

    # Whitelist Pod names (supports regex)
    # Processes in these Pods will be ignored
    podNames:
      # System Pods
      - "^coredns-.*"                # CoreDNS Pod
      - "^etcd-.*"                   # etcd Pod
      - "^kube-apiserver-.*"         # Kubernetes API Server
      - "^kube-controller-manager-.*" # Controller manager
      - "^kube-scheduler-.*"         # Scheduler
      - "^kube-proxy-.*"             # Network proxy
      - "^fluentd-.*"                # Fluentd log collector
      - "^node-exporter-.*"          # Node exporter
      - "^prometheus-.*"             # Prometheus monitoring
      - "^grafana-.*"                # Grafana visualization
      - "^alertmanager-.*"           # Alert manager

      # Network-related Pods
      - "^nginx-ingress-controller-.*" # NGINX Ingress controller
      - "^traefik-.*"                # Traefik reverse proxy
      - "^envoy-.*"                  # Envoy proxy
      - "^istio-proxy-.*"           # Istio sidecar proxy

      # Application Pods
      - "^jenkins-.*"                # Jenkins CI/CD
      - "^gitlab-runner-.*"          # GitLab Runner
      - "^elasticsearch-.*"          # Elasticsearch search engine
      - "^kibana-.*"                 # Kibana visualization
      - "^logstash-.*"               # Logstash log processing
      - "^redis-.*"                  # Redis cache
      - "^postgresql-.*"             # PostgreSQL database
      - "^mysql-.*"                  # MySQL database
      - "^mongodb-.*"                # MongoDB database

# =============================================================================
# Configuration File Description
# =============================================================================
#
# Usage:
# 1. Mount this config file to /app/config.yaml in the Pod
# 2. Or specify config file path via APROCSCAN_CONFIG_PATH environment variable
# 3. Or override config items individually via environment variables
#
# Environment variable override rules:
# - PROCSCAN_SCANNER_PROC_PATH: override scanner.proc_path
# - PROCSCAN_SCANNER_SCAN_INTERVAL: override scanner.scan_interval
# - PROCSCAN_SCANNER_LOG_LEVEL: override scanner.log_level
# - PROCSCAN_ACTIONS_LABEL_ENABLED: override actions.label.enabled
# - PROCSCAN_NOTIFICATIONS_LARK_WEBHOOK: override notifications.lark.webhook
#
# Deployment recommendations:
# 1. Production environment scan interval: 60s-300s
# 2. Development/test environment can use shorter interval: 30s
# 3. Production log level: info or warn
# 4. Whitelist rules need to be adjusted based on actual environment
# 5. Regularly update blacklist rules to address new threats
# =============================================================================
