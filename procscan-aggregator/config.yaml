# =============================================================================
# ProcScan Aggregator 配置文件
# =============================================================================
# 用于聚合 DaemonSet 中所有 Pod 的违规记录，并生成相应的 CRD

# =============================================================================
# 聚合器配置 (Aggregator)
# =============================================================================
aggregator:
  # 扫描间隔 - 多久聚合一次数据
  # 建议值：30s-300s
  scan_interval: "60s"

  # HTTP 服务端口 - 用于提供聚合数据查询 API
  port: 8090

# =============================================================================
# DaemonSet 配置 (DaemonSet)
# =============================================================================
# 配置如何发现和访问 DaemonSet 的 Pod
daemonset:
  # DaemonSet 所在的命名空间
  namespace: "kube-system"

  # Service 名称 - 用于服务发现
  # 通过 Service 的 Endpoints 获取所有 Pod IP
  service_name: "procscan"

  # API 端口 - DaemonSet Pod 暴露的 API 端口
  api_port: 9090

  # API 路径 - 获取违规记录的 API 路径
  api_path: "/api/violations"

# =============================================================================
# 日志配置 (Logger)
# =============================================================================
logger:
  # 日志级别: debug, info, warn, error
  level: "info"

  # 日志格式: json, text
  format: "json"

# =============================================================================
# 使用说明
# =============================================================================
#
# 1. 部署方式：
#    - 作为 Deployment 部署在集群中
#    - 需要配置 RBAC 权限以访问 Endpoints 和创建 CRD
#
# 2. 环境变量：
#    - KUBECONFIG: 本地开发时指定 kubeconfig 路径
#
# 3. API 端点：
#    - GET /api/violations: 获取聚合的违规记录
#    - GET /health: 健康检查
#
# 4. 工作流程：
#    - 定时通过 Service 服务发现获取所有 DaemonSet Pod IP
#    - 并发请求每个 Pod 的 API 获取违规记录
#    - 聚合所有记录
#    - 根据聚合结果生成 Higress WASM Plugin CRD 和 Notification CRD
#    - 应用 CRD 到集群
#
# =============================================================================
